<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trading Journal AI - Multi-Trade V7</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0d1117; color: #c9d1d9; }
        .card { background-color: #161b22; border: 1px solid #30363d; border-radius: 12px; overflow: hidden; }
        .input-dark { background-color: #0d1117; border: 1px solid #30363d; color: white; width: 100%; padding: 12px; border-radius: 8px; font-size: 14px; }
        .btn-blue { background-color: #238636; color: white; font-weight: bold; width: 100%; padding: 12px; border-radius: 8px; transition: 0.2s; }
        .btn-blue:active { transform: scale(0.98); }
        .status-badge { font-size: 10px; padding: 2px 8px; border-radius: 20px; font-weight: bold; }
        .tab-active { border-bottom: 2px solid #58a6ff; color: #58a6ff; }
    </style>
</head>
<body class="p-4 pb-20">
    <div class="max-w-md mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-xl font-black text-blue-500 italic">V7 <span class="text-white not-italic">PORTFOLIO</span></h1>
            <div class="text-right">
                <p class="text-[10px] text-gray-500 font-bold uppercase">Balance P&L</p>
                <p id="totalPnL" class="text-xl font-bold text-green-500">$0.0</p>
            </div>
        </div>

        <div class="card p-4 mb-6 border-t-4 border-t-blue-500">
            <h2 class="text-xs font-bold mb-4 text-blue-400 uppercase tracking-widest">Mở vị thế mới</h2>
            <form id="openTradeForm" class="space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <input type="text" id="pair" placeholder="Cặp (BTC, Gold...)" class="input-dark font-bold uppercase" required>
                    <input type="number" step="any" id="entry" placeholder="Giá Entry" class="input-dark">
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" step="any" id="sl" placeholder="Stoploss" class="input-dark text-red-400">
                    <input type="number" step="any" id="tp" placeholder="Takeprofit" class="input-dark text-green-400">
                </div>
                <textarea id="notes" placeholder="Kế hoạch giao dịch..." class="input-dark text-xs h-16"></textarea>
                <button type="submit" class="btn-blue bg-blue-600">KÍCH HOẠT VỊ THẾ</button>
            </form>
        </div>

        <div class="mb-6">
            <h2 class="text-xs font-bold mb-3 text-yellow-500 uppercase tracking-widest flex justify-between">
                Lệnh đang chạy <span id="runCount" class="bg-yellow-500/20 px-2 rounded text-yellow-500">0</span>
            </h2>
            <div id="runningTrades" class="space-y-3">
                <p id="noTrade" class="text-center text-xs text-gray-600 py-4 italic">Chưa có vị thế nào đang mở...</p>
            </div>
        </div>

        <div class="mt-8">
            <div class="flex gap-4 border-b border-gray-800 mb-4 text-xs font-bold">
                <button onclick="switchStats('history')" id="tabH" class="pb-2 tab-active">NHẬT KÝ</button>
                <button onclick="switchStats('stats')" id="tabS" class="pb-2 text-gray-500">THỐNG KÊ</button>
            </div>
            
            <div id="historyView" class="space-y-3"></div>
            
            <div id="statsView" class="hidden space-y-4">
                <div class="card p-4">
                    <p class="text-[10px] text-gray-500 mb-2 font-bold uppercase">Thống kê theo ngày</p>
                    <div id="dailyStats" class="space-y-2 text-sm"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let trades = JSON.parse(localStorage.getItem('trade_v7')) || [];

        function save() { localStorage.setItem('trade_v7', JSON.stringify(trades)); render(); }

        document.getElementById('openTradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            trades.push({
                id: Date.now(),
                pair: document.getElementById('pair').value.toUpperCase(),
                entry: document.getElementById('entry').value,
                sl: document.getElementById('sl').value,
                tp: document.getElementById('tp').value,
                note: document.getElementById('notes').value,
                status: 'running',
                pnl: 0,
                date: new Date().toLocaleDateString('vi-VN')
            });
            this.reset(); save();
        });

        function closeTrade(id) {
            const pnlVal = prompt("Nhập số tiền LÃI hoặc LỖ của lệnh này ($):", "0");
            if (pnlVal === null) return;
            
            const index = trades.findIndex(t => t.id === id);
            trades[index].pnl = parseFloat(pnlVal);
            trades[index].status = 'closed';
            trades[index].closeDate = new Date().toLocaleDateString('vi-VN');
            save();
        }

        function render() {
            const runningDiv = document.getElementById('runningTrades');
            const historyDiv = document.getElementById('historyView');
            const dailyDiv = document.getElementById('dailyStats');
            
            runningDiv.innerHTML = ''; historyDiv.innerHTML = ''; dailyDiv.innerHTML = '';
            
            let total = 0;
            let runningCount = 0;
            let dayData = {};

            trades.forEach(t => {
                if(t.status === 'running') {
                    runningCount++;
                    runningDiv.insertAdjacentHTML('beforeend', `
                        <div class="card p-4 border-l-4 border-l-yellow-500">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-bold text-white text-lg">${t.pair}</h3>
                                    <p class="text-[10px] text-gray-500 italic mt-1">"${t.note}"</p>
                                </div>
                                <button onclick="closeTrade(${t.id})" class="bg-white text-black text-[10px] font-bold px-3 py-2 rounded-lg active:scale-90">CHỐT LỆNH</button>
                            </div>
                            <div class="grid grid-cols-3 gap-2 mt-3 text-[10px] text-gray-400 bg-black/20 p-2 rounded">
                                <div>E: ${t.entry}</div><div>SL: ${t.sl}</div><div>TP: ${t.tp}</div>
                            </div>
                        </div>
                    `);
                } else {
                    total += t.pnl;
                    dayData[t.date] = (dayData[t.date] || 0) + t.pnl;
                    historyDiv.insertAdjacentHTML('afterbegin', `
                        <div class="card p-3 flex justify-between items-center opacity-80 border-l-4 ${t.pnl>=0?'border-l-green-500':'border-l-red-500'}">
                            <div>
                                <span class="font-bold text-sm">${t.pair}</span>
                                <p class="text-[9px] text-gray-600">${t.date}</p>
                            </div>
                            <span class="font-bold ${t.pnl>=0?'text-green-500':'text-red-500'}">${t.pnl>=0?'+':''}${t.pnl}$</span>
                        </div>
                    `);
                }
            });

            document.getElementById('noTrade').style.display = runningCount === 0 ? 'block' : 'none';
            document.getElementById('runCount').innerText = runningCount;
            document.getElementById('totalPnL').innerText = (total >= 0 ? '+' : '') + total.toFixed(1) + '$';
            document.getElementById('totalPnL').className = `text-xl font-bold ${total>=0?'text-green-500':'text-red-500'}`;

            Object.keys(dayData).reverse().forEach(d => {
                dailyDiv.insertAdjacentHTML('beforeend', `<div class="flex justify-between border-b border-gray-800 pb-1"><span>${d}</span><span class="font-bold ${dayData[d]>=0?'text-green-400':'text-red-400'}">${dayData[d]}$</span></div>`);
            });
        }

        function switchStats(type) {
            document.getElementById('historyView').classList.toggle('hidden', type !== 'history');
            document.getElementById('statsView').classList.toggle('hidden', type !== 'stats');
            document.getElementById('tabH').classList.toggle('tab-active', type === 'history');
            document.getElementById('tabS').classList.toggle('tab-active', type === 'stats');
        }

        render();
    </script>
</body>
</html>
