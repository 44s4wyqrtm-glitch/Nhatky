<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trading Journal AI - Stats Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0b0f1a; color: #e2e8f0; }
        .card { background-color: #161c2d; border: 1px solid #2d3748; border-radius: 12px; }
        .input-dark { background-color: #0b0f1a; border: 1px solid #2d3748; color: white; width: 100%; padding: 10px; border-radius: 8px; font-size: 13px; }
        .tab-btn { flex: 1; padding: 10px; font-size: 11px; font-weight: bold; border-radius: 8px; transition: 0.2s; color: #64748b; }
        .tab-active { background-color: #3b82f6; color: white; }
    </style>
</head>
<body class="p-4 pb-20">
    <div class="max-w-md mx-auto">
        <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="card p-4 text-center border-b-2 border-b-green-500">
                <p class="text-[9px] text-gray-500 font-bold uppercase">Tổng P&L</p>
                <p id="totalPnL" class="text-xl font-bold text-green-500">$0</p>
            </div>
            <div class="card p-4 text-center border-b-2 border-b-blue-500">
                <p class="text-[9px] text-gray-500 font-bold uppercase">Tháng này</p>
                <p id="monthPnL" class="text-xl font-bold text-blue-400">$0</p>
            </div>
        </div>

        <div class="flex gap-2 bg-slate-900/50 p-1 rounded-xl mb-4">
            <button onclick="showTab('input')" id="tab1" class="tab-btn tab-active">NHẬP LỆNH</button>
            <button onclick="showTab('stats')" id="tab2" class="tab-btn">THỐNG KÊ CHI TIẾT</button>
        </div>

        <div id="inputTab" class="space-y-4">
            <div class="card p-4">
                <form id="tradeForm" class="space-y-3">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="pair" placeholder="CẶP TIỀN" class="input-dark font-bold uppercase" required>
                        <input type="number" step="any" id="pnl" placeholder="LÃI/LỖ ($)" class="input-dark font-bold" required>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <input type="number" step="any" id="entry" placeholder="Entry" class="input-dark text-[11px]">
                        <input type="number" step="any" id="sl" placeholder="SL" class="input-dark text-[11px]">
                        <input type="number" step="any" id="tp" placeholder="TP" class="input-dark text-[11px]">
                    </div>
                    <textarea id="notes" placeholder="Ghi chú nhanh..." class="input-dark text-xs h-16"></textarea>
                    <button type="submit" class="w-full bg-blue-600 py-3 rounded-lg font-bold text-sm">LƯU NHẬT KÝ</button>
                </form>
            </div>

            <h3 class="text-[10px] font-bold text-gray-500 uppercase">Lịch sử hôm nay</h3>
            <div id="dailyList" class="space-y-2"></div>
        </div>

        <div id="statsTab" class="hidden space-y-4">
            <div class="card p-4">
                <h4 class="text-xs font-bold text-gray-400 mb-3 uppercase">Lợi nhuận theo Tháng</h4>
                <div id="monthlyBox" class="space-y-2"></div>
            </div>
            <div class="card p-4">
                <h4 class="text-xs font-bold text-gray-400 mb-3 uppercase">Lợi nhuận theo Ngày</h4>
                <div id="dailyBox" class="space-y-2 max-h-64 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <script>
        let trades = JSON.parse(localStorage.getItem('tradingDataV6')) || [];

        function showTab(name) {
            document.getElementById('inputTab').classList.toggle('hidden', name !== 'input');
            document.getElementById('statsTab').classList.toggle('hidden', name !== 'stats');
            document.getElementById('tab1').classList.toggle('tab-active', name === 'input');
            document.getElementById('tab2').classList.toggle('tab-active', name === 'stats');
            if(name === 'stats') renderStats();
        }

        function updateUI() {
            const dailyList = document.getElementById('dailyList');
            dailyList.innerHTML = '';
            let total = 0, monthTotal = 0;
            const now = new Date();
            const todayStr = now.toLocaleDateString('vi-VN');
            const thisMonth = now.getMonth() + 1 + '/' + now.getFullYear();

            trades.forEach(t => {
                const val = parseFloat(t.pnl);
                total += val;
                if(t.date.includes(thisMonth)) monthTotal += val;
                if(t.date.split(' ')[0] === todayStr) {
                    dailyList.insertAdjacentHTML('afterbegin', `
                        <div class="card p-3 flex justify-between border-l-4 ${val>=0?'border-l-green-500':'border-l-red-500'}">
                            <span class="font-bold">${t.pair}</span>
                            <span class="font-bold ${val>=0?'text-green-500':'text-red-500'}">${val}$</span>
                        </div>
                    `);
                }
            });

            document.getElementById('totalPnL').innerText = '$' + total.toFixed(1);
            document.getElementById('monthPnL').innerText = '$' + monthTotal.toFixed(1);
            localStorage.setItem('tradingDataV6', JSON.stringify(trades));
        }

        function renderStats() {
            const mBox = document.getElementById('monthlyBox');
            const dBox = document.getElementById('dailyBox');
            mBox.innerHTML = ''; dBox.innerHTML = '';
            
            const mData = {}, dData = {};
            trades.forEach(t => {
                const d = t.date.split(' ')[0];
                const m = d.split('/')[1] + '/' + d.split('/')[2];
                mData[m] = (mData[m] || 0) + parseFloat(t.pnl);
                dData[d] = (dData[d] || 0) + parseFloat(t.pnl);
            });

            Object.keys(mData).reverse().forEach(k => {
                mBox.insertAdjacentHTML('beforeend', `<div class="flex justify-between text-sm"><span>Tháng ${k}</span><span class="font-bold ${mData[k]>=0?'text-green-400':'text-red-400'}">${mData[k].toFixed(1)}$</span></div>`);
            });

            Object.keys(dData).reverse().forEach(k => {
                dBox.insertAdjacentHTML('beforeend', `<div class="flex justify-between text-xs py-1 border-b border-gray-800"><span>Ngày ${k}</span><span class="font-bold ${dData[k]>=0?'text-green-500':'text-red-500'}">${dData[k].toFixed(1)}$</span></div>`);
            });
        }

        document.getElementById('tradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            trades.push({
                pair: document.getElementById('pair').value.toUpperCase(),
                pnl: document.getElementById('pnl').value,
                entry: document.getElementById('entry').value,
                sl: document.getElementById('sl').value,
                tp: document.getElementById('tp').value,
                note: document.getElementById('notes').value,
                date: new Date().toLocaleDateString('vi-VN') + ' ' + new Date().toLocaleTimeString('vi-VN')
            });
            updateUI(); this.reset();
        });

        updateUI();
    </script>
</body>
</html>
